<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Generate PDF from Form Data</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" crossorigin="anonymous"></script>
    <script>
        function generatePDF() {
            var firstName = $("#firstName").val();
            var lastName = $("#lastName").val();
            var selectedDate = $("#selectedDate").val();
            var reason = $("#reason").val();

            if (!firstName || !lastName || !selectedDate || !reason) {
                console.error("One or more form fields are empty. Please fill in all the fields.");
                return;
            }

            var doc = new jsPDF();

            // Add form data to the PDF
            doc.text(20, 20, 'First Name: ' + firstName);
            doc.text(20, 30, 'Last Name: ' + lastName);
            doc.text(20, 40, 'Selected Date: ' + selectedDate);
            doc.text(20, 50, 'Reason: ' + reason);

            // Save the PDF document
            doc.save("form-data.pdf");

            // Get the base64 data URL of the PDF
            var pdfData = doc.output('datauristring');

            // Send the PDF data to the API via an AJAX POST request
            $.ajax({
                type: 'POST',
                url: '/submit', // Assuming your endpoint is mapped to /form/submit
                data: {
                    firstName: firstName,
                    lastName: lastName,
                    selectedDate: selectedDate,
                    reason: reason,
                    pdfData: pdfData
                },
                success: function (response) {
                    console.log(response);
                },
                error: function (xhr) {
                    console.error(xhr.responseText);
                }
            });
        }
    </script>
</head>
<body>
<!-- Add the title to the form -->
<h1>MyForm from thymeleaf</h1>

<!-- The form to get the input values -->
    <form>
        <label for="firstName">First Name:</label><br>
        <input type="text" id="firstName" name="firstName" th:field="*{firstName}"><br>

        <label for="lastName">Last Name:</label><br>
        <input type="text" id="lastName" name="lastName" th:field="*{lastName}"><br>

        <label for="selectedDate">Select Date:</label><br>
        <input type="date" id="selectedDate" name="selectedDate" th:field="*{selectedDate}"><br>

        <label for="reason">Reason:</label><br>
        <textarea id="reason" name="reason" th:field="*{reason}"></textarea><br><br>

        <input type="button" value="Generate PDF" onclick="generatePDF()">
    </form>

</body>
</html>
